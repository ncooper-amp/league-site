<% include header.ejs %>
<% include nav.ejs %>


  <% if (error) { %>
    <p>Something seems to have gone wrong</p>
    <p><%= error %></p>
  <% }
  else { %>
    <h1><%= division.replace('-',' ') %></h1>
    <% if (typeof admin !== 'undefined') { %>

      <p>Welcome!<br />
        <%= user[0].nickname %><br />
        Club:<%= user[0].app_metadata.club %><br />
        Role:<%= user[0].app_metadata.role %>
      </p>

    <% } %>
    <div class="table-responsive">
    <table class="table" id="results-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Home Team</th>
          <th>Away Team</th>
          <th>Result</th>
          <% if (typeof admin !== 'undefined') { %>
            <th>Details</th>
            <th>Edit</th>
            <th>Confirm</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
    <% result.forEach(function(row){ %>
      <%
        var rowClass = '';
        var resultValue = '';
        var MyDate = new Date(row['date']);
        var NowDate = Date.now();
        if ((MyDate < NowDate) && (row['homeScore'] == null)) {
          rowClass = 'table-danger'
          var resultValue = 'Awaiting Result';
        }
        var MyDateString;

        // MyDate.setDate(MyDate.getDate() + 20);

        MyDateString = ('0' + MyDate.getDate()).slice(-2) + '/'
                     + ('0' + (MyDate.getMonth()+1)).slice(-2) + '/'
                     + MyDate.getFullYear();
      %>

      <% if (row['status'] == 'rearranging'){
        var rowClass = 'table-warning';
        var resultValue = 'Rearranging';
       }
       %>
       <% if (row['status'] == 'rearranged'){
        var rowClass = 'table-warning';
        var resultValue = 'Rearranged';
       }
       %>

       <% if (row['status'] == 'conceded'){
         var rowClass = 'table-danger';
         var status = "conceded"
        }
        else {
          var status = ""
        }
        %>

      <tr class="<%= rowClass %>">

          <td><%= MyDateString %></td>
          <td><%= row['homeTeam'] %></td>
          <td><%= row['awayTeam'] %></td>
          <% if(row['homeScore'] != null){ %>
          <td><%= row['homeScore'] %>-<%= row['awayScore'] %> <%= status %></td>
          <% }
          else { %>
           <td><%= resultValue %></td>
          <% } %>
          <% if (typeof admin !== 'undefined') { %>
            <td><a data-toggle="modal" data-target="#exampleModal" data-club="<%= row['name'] %>">Rearrange</a></td>
            <td><a href="/scorecard/fixture/<%= row['fixtureId'] %>">Details</a></td>
            <td><a href="/fixtures/edit/<%= row['fixtureId'] %>">Edit</a></td>
            <td><a href="/fixtures/review/<%= row['fixtureId'] %>">Review</a></td>
          <% } %>
      </tr>
    <% }) %>
      </tbody>
      <<tfoot>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
   <% } %>

   <% if (typeof admin !== 'undefined') { %>
   
   <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Rearrangement</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form role="form" id="contactUs" action="/fixture/rearrangment" method="post">
        <div class="modal-body">

            <div class="form-group">
              <label for="contactEmail">New Fixture Date</label>
              <input type="date" class="form-control" id="date" name="date" placeholder="DD/MM/YYYY">
              <small id="emailHelp" class="form-text text-muted">Leave this blank if you haven't fixed a date yet.</small>
            </div>
            <div class="form-group">
              <div class="g-recaptcha" data-sitekey="<%= recaptcha %>"></div>
            </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
        </form>
      </div>
    </div>
  </div>

  <% } %>


<% include footer.ejs %>
<% include datatables.ejs %>

</body>
</html>
